<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Robot efficiency</title>
  </head>
  <body>
    <script src="../chapter/07_robot.js"></script>
    <script>
      function runRobot(state, robot, memory) {
        for (let turn = 0; ; turn++) {
          if (state.parcels.length == 0) {
            // console.log(`Done in ${turn} turns`);
            // break;
            return turn;
          }
          let action = robot(state, memory);
          state = state.move(action.direction);
          memory = action.memory;
          // console.log(`Moved to ${action.direction}`);
        }
      }

      function myRobot({place, parcels}, route) {
        if (route.length == 0) {
          let routesArr = [];
          for (const parcel of parcels) {
            if (parcel.place != place) {
              route = findRoute(roadGraph, place, parcel.place);
            } else {
              route = findRoute(roadGraph, place, parcel.address);
            }
            routesArr.push(route);
          }
          routesArr.sort((a, b) => a.length - b.length);
          route = routesArr[0];
        }
        return {direction: route[0], memory: route.slice(1)};
      }
      console.log(runRobot(VillageState.random(), myRobot, []));

      function compareRobots(robot1, memory1, robot2, memory2) {
        let tasks = 100;
        let avgTurnsRobot1 = 0;
        let avgTurnsRobot2 = 0;
        for (let i = 0; i < tasks; i++) {
          let state = VillageState.random();
          avgTurnsRobot1 = avgTurnsRobot1 + runRobot(state, robot1, memory1);
          avgTurnsRobot2 = avgTurnsRobot2 + runRobot(state, robot2, memory2);
        }
        console.log(`average turns robot1: ${avgTurnsRobot1 / tasks}`);
        console.log(`average turns robot2: ${avgTurnsRobot2 / tasks}`);
      }
      compareRobots(goalOrientedRobot, [], myRobot, []);
    </script>
  </body>
</html>
